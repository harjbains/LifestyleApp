script.onload = async () => {
  await window.Clerk.load({
    publishableKey: clerkPubKey
  });

  const homeUrl = window.location.origin + window.location.pathname;

  if (window.Clerk.user) {
    // 1. User is logged in: Show the app
    document.body.style.display = "block";
    USER_ID = window.Clerk.user.id;
    
    const userBtn = document.getElementById('user-button') || document.createElement('div');
    userBtn.id = "user-button";
    userBtn.style.marginLeft = "auto";
    if (!document.getElementById('user-button')) {
        document.querySelector('.tabs').appendChild(userBtn);
    }
    
    window.Clerk.mountUserButton(userBtn, {
      afterSignOutUrl: homeUrl
    });

    init(); 
  } else {
    // 2. User is logged out: Keep body hidden but open the login modal
    // This modal will sit on top of the 'hidden' body
    window.Clerk.openSignIn({
      afterSignInUrl: homeUrl,
      afterSignUpUrl: homeUrl,
      signInForceRedirectUrl: homeUrl
    });
  }
};
